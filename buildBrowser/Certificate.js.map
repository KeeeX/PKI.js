{"version":3,"sources":["../src/Certificate.js"],"names":["tbsCertificate","parameters","names","asn1js","Sequence","name","blockName","value","Constructed","optional","idBlock","tagClass","tagNumber","Integer","tbsCertificateVersion","tbsCertificateSerialNumber","AlgorithmIdentifier","schema","signature","RelativeDistinguishedNames","issuer","tbsCertificateValidity","Time","notBefore","utcTimeName","generalTimeName","notAfter","subject","PublicKeyInfo","subjectPublicKeyInfo","Primitive","tbsCertificateIssuerUniqueID","tbsCertificateSubjectUniqueID","Extensions","extensions","Certificate","tbs","defaultValues","version","serialNumber","issuerUniqueID","subjectUniqueID","signatureAlgorithm","signatureValue","fromSchema","asn1","compareSchema","verified","Error","result","valueBeforeDecode","valueBlock","valueDec","valueHex","Array","from","element","Extension","outputArray","push","toSchema","encodeFlag","tbsSchema","length","fromBER","encodeTBS","object","byteLength","toJSON","subtle","getPublicKey","hashAlgorithm","crypto","Promise","reject","digest","Uint8Array","subjectPublicKey","privateKey","sequence","resolve","engine","then","getSignatureParameters","toBER","signWithPrivateKey","BitString","issuerCertificate","isEqual","verifyWithPublicKey","memberName","ArrayBuffer"],"mappings":"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","sourcesContent":["import * as asn1js from \"asn1js\";\r\nimport { getParametersValue, bufferToHexCodes, clearProps } from \"pvutils\";\r\nimport { getCrypto, getEngine } from \"./common.js\";\r\nimport AlgorithmIdentifier from \"./AlgorithmIdentifier.js\";\r\nimport RelativeDistinguishedNames from \"./RelativeDistinguishedNames.js\";\r\nimport Time from \"./Time.js\";\r\nimport PublicKeyInfo from \"./PublicKeyInfo.js\";\r\nimport Extension from \"./Extension.js\";\r\nimport Extensions from \"./Extensions.js\";\r\n//**************************************************************************************\r\nfunction tbsCertificate(parameters = {})\r\n{\r\n\t//TBSCertificate  ::=  SEQUENCE  {\r\n\t//    version         [0]  EXPLICIT Version DEFAULT v1,\r\n\t//    serialNumber         CertificateSerialNumber,\r\n\t//    signature            AlgorithmIdentifier,\r\n\t//    issuer               Name,\r\n\t//    validity             Validity,\r\n\t//    subject              Name,\r\n\t//    subjectPublicKeyInfo SubjectPublicKeyInfo,\r\n\t//    issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,\r\n\t//                         -- If present, version MUST be v2 or v3\r\n\t//    subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,\r\n\t//                         -- If present, version MUST be v2 or v3\r\n\t//    extensions      [3]  EXPLICIT Extensions OPTIONAL\r\n\t//    -- If present, version MUST be v3\r\n\t//}\r\n\t\r\n\t/**\r\n\t * @type {Object}\r\n\t * @property {string} [blockName]\r\n\t * @property {string} [tbsCertificateVersion]\r\n\t * @property {string} [tbsCertificateSerialNumber]\r\n\t * @property {string} [signature]\r\n\t * @property {string} [issuer]\r\n\t * @property {string} [tbsCertificateValidity]\r\n\t * @property {string} [notBefore]\r\n\t * @property {string} [notAfter]\r\n\t * @property {string} [subject]\r\n\t * @property {string} [subjectPublicKeyInfo]\r\n\t * @property {string} [tbsCertificateIssuerUniqueID]\r\n\t * @property {string} [tbsCertificateSubjectUniqueID]\r\n\t * @property {string} [extensions]\r\n\t */\r\n\tconst names = getParametersValue(parameters, \"names\", {});\r\n\t\r\n\treturn (new asn1js.Sequence({\r\n\t\tname: (names.blockName || \"tbsCertificate\"),\r\n\t\tvalue: [\r\n\t\t\tnew asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 0 // [0]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tnew asn1js.Integer({ name: (names.tbsCertificateVersion || \"tbsCertificate.version\") }) // EXPLICIT integer value\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Integer({ name: (names.tbsCertificateSerialNumber || \"tbsCertificate.serialNumber\") }),\r\n\t\t\tAlgorithmIdentifier.schema(names.signature || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.signature\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tRelativeDistinguishedNames.schema(names.issuer || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.issuer\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Sequence({\r\n\t\t\t\tname: (names.tbsCertificateValidity || \"tbsCertificate.validity\"),\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tTime.schema(names.notBefore || {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\tutcTimeName: \"tbsCertificate.notBefore\",\r\n\t\t\t\t\t\t\tgeneralTimeName: \"tbsCertificate.notBefore\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tTime.schema(names.notAfter || {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\tutcTimeName: \"tbsCertificate.notAfter\",\r\n\t\t\t\t\t\t\tgeneralTimeName: \"tbsCertificate.notAfter\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tRelativeDistinguishedNames.schema(names.subject || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.subject\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tPublicKeyInfo.schema(names.subjectPublicKeyInfo || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.subjectPublicKeyInfo\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Primitive({\r\n\t\t\t\tname: (names.tbsCertificateIssuerUniqueID || \"tbsCertificate.issuerUniqueID\"),\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 1 // [1]\r\n\t\t\t\t}\r\n\t\t\t}), // IMPLICIT bistring value\r\n\t\t\tnew asn1js.Primitive({\r\n\t\t\t\tname: (names.tbsCertificateSubjectUniqueID || \"tbsCertificate.subjectUniqueID\"),\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 2 // [2]\r\n\t\t\t\t}\r\n\t\t\t}), // IMPLICIT bistring value\r\n\t\t\tnew asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 3 // [3]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [Extensions.schema(names.extensions || {\r\n\t\t\t\t\tnames: {\r\n\t\t\t\t\t\tblockName: \"tbsCertificate.extensions\"\r\n\t\t\t\t\t}\r\n\t\t\t\t})]\r\n\t\t\t}) // EXPLICIT SEQUENCE value\r\n\t\t]\r\n\t}));\r\n}\r\n//**************************************************************************************\r\n/**\r\n * Class from RFC5280\r\n */\r\nexport default class Certificate\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for Certificate class\r\n\t * @param {Object} [parameters={}]\r\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {ArrayBuffer}\r\n\t\t * @desc ToBeSigned (TBS) part of the certificate\r\n\t\t */\r\n\t\tthis.tbs = getParametersValue(parameters, \"tbs\", Certificate.defaultValues(\"tbs\"));\r\n\t\t/**\r\n\t\t * @type {number}\r\n\t\t * @desc Version number\r\n\t\t */\r\n\t\tthis.version = getParametersValue(parameters, \"version\", Certificate.defaultValues(\"version\"));\r\n\t\t/**\r\n\t\t * @type {Integer}\r\n\t\t * @desc Serial number of the certificate\r\n\t\t */\r\n\t\tthis.serialNumber = getParametersValue(parameters, \"serialNumber\", Certificate.defaultValues(\"serialNumber\"));\r\n\t\t/**\r\n\t\t * @type {AlgorithmIdentifier}\r\n\t\t * @desc This field contains the algorithm identifier for the algorithm used by the CA to sign the certificate\r\n\t\t */\r\n\t\tthis.signature = getParametersValue(parameters, \"signature\", Certificate.defaultValues(\"signature\"));\r\n\t\t/**\r\n\t\t * @type {RelativeDistinguishedNames}\r\n\t\t * @desc The issuer field identifies the entity that has signed and issued the certificate\r\n\t\t */\r\n\t\tthis.issuer = getParametersValue(parameters, \"issuer\", Certificate.defaultValues(\"issuer\"));\r\n\t\t/**\r\n\t\t * @type {Time}\r\n\t\t * @desc The date on which the certificate validity period begins\r\n\t\t */\r\n\t\tthis.notBefore = getParametersValue(parameters, \"notBefore\", Certificate.defaultValues(\"notBefore\"));\r\n\t\t/**\r\n\t\t * @type {Time}\r\n\t\t * @desc The date on which the certificate validity period ends\r\n\t\t */\r\n\t\tthis.notAfter = getParametersValue(parameters, \"notAfter\", Certificate.defaultValues(\"notAfter\"));\r\n\t\t/**\r\n\t\t * @type {RelativeDistinguishedNames}\r\n\t\t * @desc The subject field identifies the entity associated with the public key stored in the subject public key field\r\n\t\t */\r\n\t\tthis.subject = getParametersValue(parameters, \"subject\", Certificate.defaultValues(\"subject\"));\r\n\t\t/**\r\n\t\t * @type {PublicKeyInfo}\r\n\t\t * @desc This field is used to carry the public key and identify the algorithm with which the key is used\r\n\t\t */\r\n\t\tthis.subjectPublicKeyInfo = getParametersValue(parameters, \"subjectPublicKeyInfo\", Certificate.defaultValues(\"subjectPublicKeyInfo\"));\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {ArrayBuffer}\r\n\t\t\t * @desc The subject and issuer unique identifiers are present in the certificate to handle the possibility of reuse of subject and/or issuer names over time\r\n\t\t\t */\r\n\t\t\tthis.issuerUniqueID = getParametersValue(parameters, \"issuerUniqueID\", Certificate.defaultValues(\"issuerUniqueID\"));\r\n\t\t\r\n\t\tif(\"subjectUniqueID\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {ArrayBuffer}\r\n\t\t\t * @desc The subject and issuer unique identifiers are present in the certificate to handle the possibility of reuse of subject and/or issuer names over time\r\n\t\t\t */\r\n\t\t\tthis.subjectUniqueID = getParametersValue(parameters, \"subjectUniqueID\", Certificate.defaultValues(\"subjectUniqueID\"));\r\n\t\t\r\n\t\tif(\"extensions\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {Array}\r\n\t\t\t * @desc If present, this field is a SEQUENCE of one or more certificate extensions\r\n\t\t\t */\r\n\t\t\tthis.extensions = getParametersValue(parameters, \"extensions\", Certificate.defaultValues(\"extensions\"));\r\n\t\t\r\n\t\t/**\r\n\t\t * @type {AlgorithmIdentifier}\r\n\t\t * @desc The signatureAlgorithm field contains the identifier for the cryptographic algorithm used by the CA to sign this certificate\r\n\t\t */\r\n\t\tthis.signatureAlgorithm = getParametersValue(parameters, \"signatureAlgorithm\", Certificate.defaultValues(\"signatureAlgorithm\"));\r\n\t\t/**\r\n\t\t * @type {BitString}\r\n\t\t * @desc The signatureValue field contains a digital signature computed upon the ASN.1 DER encoded tbsCertificate\r\n\t\t */\r\n\t\tthis.signatureValue = getParametersValue(parameters, \"signatureValue\", Certificate.defaultValues(\"signatureValue\"));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region If input argument array contains \"schema\" for this object\r\n\t\tif(\"schema\" in parameters)\r\n\t\t\tthis.fromSchema(parameters.schema);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t */\r\n\tstatic defaultValues(memberName)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"tbs\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"version\":\r\n\t\t\t\treturn 0;\r\n\t\t\tcase \"serialNumber\":\r\n\t\t\t\treturn new asn1js.Integer();\r\n\t\t\tcase \"signature\":\r\n\t\t\t\treturn new AlgorithmIdentifier();\r\n\t\t\tcase \"issuer\":\r\n\t\t\t\treturn new RelativeDistinguishedNames();\r\n\t\t\tcase \"notBefore\":\r\n\t\t\t\treturn new Time();\r\n\t\t\tcase \"notAfter\":\r\n\t\t\t\treturn new Time();\r\n\t\t\tcase \"subject\":\r\n\t\t\t\treturn new RelativeDistinguishedNames();\r\n\t\t\tcase \"subjectPublicKeyInfo\":\r\n\t\t\t\treturn new PublicKeyInfo();\r\n\t\t\tcase \"issuerUniqueID\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"subjectUniqueID\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"extensions\":\r\n\t\t\t\treturn [];\r\n\t\t\tcase \"signatureAlgorithm\":\r\n\t\t\t\treturn new AlgorithmIdentifier();\r\n\t\t\tcase \"signatureValue\":\r\n\t\t\t\treturn new asn1js.BitString();\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for Certificate class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return value of pre-defined ASN.1 schema for current class\r\n\t *\r\n\t * ASN.1 schema:\r\n\t * ```asn1\r\n\t * Certificate  ::=  SEQUENCE  {\r\n\t *    tbsCertificate       TBSCertificate,\r\n\t *    signatureAlgorithm   AlgorithmIdentifier,\r\n\t *    signatureValue       BIT STRING  }\r\n\t * ```\r\n\t *\r\n\t * @param {Object} parameters Input parameters for the schema\r\n\t * @returns {Object} asn1js schema object\r\n\t */\r\n\tstatic schema(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @property {string} [blockName]\r\n\t\t * @property {string} [tbsCertificate]\r\n\t\t * @property {string} [signatureAlgorithm]\r\n\t\t * @property {string} [signatureValue]\r\n\t\t */\r\n\t\tconst names = getParametersValue(parameters, \"names\", {});\r\n\t\t\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tname: (names.blockName || \"\"),\r\n\t\t\tvalue: [\r\n\t\t\t\ttbsCertificate(names.tbsCertificate),\r\n\t\t\t\tAlgorithmIdentifier.schema(names.signatureAlgorithm || {\r\n\t\t\t\t\tnames: {\r\n\t\t\t\t\t\tblockName: \"signatureAlgorithm\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew asn1js.BitString({ name: (names.signatureValue || \"signatureValue\") })\r\n\t\t\t]\r\n\t\t}));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert parsed asn1js object into current class\r\n\t * @param {!Object} schema\r\n\t */\r\n\tfromSchema(schema)\r\n\t{\r\n\t\t//region Clear input data first\r\n\t\tclearProps(schema, [\r\n\t\t\t\"tbsCertificate\",\r\n\t\t\t\"tbsCertificate.extensions\",\r\n\t\t\t\"tbsCertificate.version\",\r\n\t\t\t\"tbsCertificate.serialNumber\",\r\n\t\t\t\"tbsCertificate.signature\",\r\n\t\t\t\"tbsCertificate.issuer\",\r\n\t\t\t\"tbsCertificate.notBefore\",\r\n\t\t\t\"tbsCertificate.notAfter\",\r\n\t\t\t\"tbsCertificate.subject\",\r\n\t\t\t\"tbsCertificate.subjectPublicKeyInfo\",\r\n\t\t\t\"tbsCertificate.issuerUniqueID\",\r\n\t\t\t\"tbsCertificate.subjectUniqueID\",\r\n\t\t\t\"signatureAlgorithm\",\r\n\t\t\t\"signatureValue\"\r\n\t\t]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check the schema is valid\r\n\t\tconst asn1 = asn1js.compareSchema(schema,\r\n\t\t\tschema,\r\n\t\t\tCertificate.schema({\r\n\t\t\t\tnames: {\r\n\t\t\t\t\ttbsCertificate: {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\textensions: {\r\n\t\t\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\t\t\textensions: \"tbsCertificate.extensions\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\t\r\n\t\tif(asn1.verified === false)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for Certificate\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get internal properties from parsed schema\r\n\t\tthis.tbs = asn1.result.tbsCertificate.valueBeforeDecode;\r\n\t\t\r\n\t\tif(\"tbsCertificate.version\" in asn1.result)\r\n\t\t\tthis.version = asn1.result[\"tbsCertificate.version\"].valueBlock.valueDec;\r\n\t\tthis.serialNumber = asn1.result[\"tbsCertificate.serialNumber\"];\r\n\t\tthis.signature = new AlgorithmIdentifier({ schema: asn1.result[\"tbsCertificate.signature\"] });\r\n\t\tthis.issuer = new RelativeDistinguishedNames({ schema: asn1.result[\"tbsCertificate.issuer\"] });\r\n\t\tthis.notBefore = new Time({ schema: asn1.result[\"tbsCertificate.notBefore\"] });\r\n\t\tthis.notAfter = new Time({ schema: asn1.result[\"tbsCertificate.notAfter\"] });\r\n\t\tthis.subject = new RelativeDistinguishedNames({ schema: asn1.result[\"tbsCertificate.subject\"] });\r\n\t\tthis.subjectPublicKeyInfo = new PublicKeyInfo({ schema: asn1.result[\"tbsCertificate.subjectPublicKeyInfo\"] });\r\n\t\tif(\"tbsCertificate.issuerUniqueID\" in asn1.result)\r\n\t\t\tthis.issuerUniqueID = asn1.result[\"tbsCertificate.issuerUniqueID\"].valueBlock.valueHex;\r\n\t\tif(\"tbsCertificate.subjectUniqueID\" in asn1.result)\r\n\t\t\tthis.subjectUniqueID = asn1.result[\"tbsCertificate.subjectUniqueID\"].valueBlock.valueHex;\r\n\t\tif(\"tbsCertificate.extensions\" in asn1.result)\r\n\t\t\tthis.extensions = Array.from(asn1.result[\"tbsCertificate.extensions\"], element => new Extension({ schema: element }));\r\n\t\t\r\n\t\tthis.signatureAlgorithm = new AlgorithmIdentifier({ schema: asn1.result.signatureAlgorithm });\r\n\t\tthis.signatureValue = asn1.result.signatureValue;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Create ASN.1 schema for existing values of TBS part for the certificate\r\n\t */\r\n\tencodeTBS()\r\n\t{\r\n\t\t//region Create array for output sequence\r\n\t\tconst outputArray = [];\r\n\t\t\r\n\t\tif((\"version\" in this) && (this.version !== Certificate.defaultValues(\"version\")))\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 0 // [0]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tnew asn1js.Integer({ value: this.version }) // EXPLICIT integer value\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t\toutputArray.push(this.serialNumber);\r\n\t\toutputArray.push(this.signature.toSchema());\r\n\t\toutputArray.push(this.issuer.toSchema());\r\n\t\t\r\n\t\toutputArray.push(new asn1js.Sequence({\r\n\t\t\tvalue: [\r\n\t\t\t\tthis.notBefore.toSchema(),\r\n\t\t\t\tthis.notAfter.toSchema()\r\n\t\t\t]\r\n\t\t}));\r\n\t\t\r\n\t\toutputArray.push(this.subject.toSchema());\r\n\t\toutputArray.push(this.subjectPublicKeyInfo.toSchema());\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Primitive({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 1 // [1]\r\n\t\t\t\t},\r\n\t\t\t\tvalueHex: this.issuerUniqueID\r\n\t\t\t}));\r\n\t\t}\r\n\t\tif(\"subjectUniqueID\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Primitive({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 2 // [2]\r\n\t\t\t\t},\r\n\t\t\t\tvalueHex: this.subjectUniqueID\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t\tif(\"extensions\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 3 // [3]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [new asn1js.Sequence({\r\n\t\t\t\t\tvalue: Array.from(this.extensions, element => element.toSchema())\r\n\t\t\t\t})]\r\n\t\t\t}));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create and return output sequence\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tvalue: outputArray\r\n\t\t}));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to asn1js object and set correct values\r\n\t * @returns {Object} asn1js object\r\n\t */\r\n\ttoSchema(encodeFlag = false)\r\n\t{\r\n\t\tlet tbsSchema = {};\r\n\t\t\r\n\t\t//region Decode stored TBS value\r\n\t\tif(encodeFlag === false)\r\n\t\t{\r\n\t\t\tif(this.tbs.length === 0) // No stored certificate TBS part\r\n\t\t\t\treturn Certificate.schema().value[0];\r\n\t\t\t\r\n\t\t\ttbsSchema = asn1js.fromBER(this.tbs).result;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t//region Create TBS schema via assembling from TBS parts\r\n\t\telse\r\n\t\t\ttbsSchema = this.encodeTBS();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Construct and return new ASN.1 schema for this object\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tvalue: [\r\n\t\t\t\ttbsSchema,\r\n\t\t\t\tthis.signatureAlgorithm.toSchema(),\r\n\t\t\t\tthis.signatureValue\r\n\t\t\t]\r\n\t\t}));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convertion for the class to JSON object\r\n\t * @returns {Object}\r\n\t */\r\n\ttoJSON()\r\n\t{\r\n\t\tconst object = {\r\n\t\t\ttbs: bufferToHexCodes(this.tbs, 0, this.tbs.byteLength),\r\n\t\t\tserialNumber: this.serialNumber.toJSON(),\r\n\t\t\tsignature: this.signature.toJSON(),\r\n\t\t\tissuer: this.issuer.toJSON(),\r\n\t\t\tnotBefore: this.notBefore.toJSON(),\r\n\t\t\tnotAfter: this.notAfter.toJSON(),\r\n\t\t\tsubject: this.subject.toJSON(),\r\n\t\t\tsubjectPublicKeyInfo: this.subjectPublicKeyInfo.toJSON(),\r\n\t\t\tsignatureAlgorithm: this.signatureAlgorithm.toJSON(),\r\n\t\t\tsignatureValue: this.signatureValue.toJSON()\r\n\t\t};\r\n\t\t\r\n\t\tif((\"version\" in this) && (this.version !== Certificate.defaultValues(\"version\")))\r\n\t\t\tobject.version = this.version;\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in this)\r\n\t\t\tobject.issuerUniqueID = bufferToHexCodes(this.issuerUniqueID, 0, this.issuerUniqueID.byteLength);\r\n\t\t\r\n\t\tif(\"subjectUniqueID\" in this)\r\n\t\t\tobject.subjectUniqueID = bufferToHexCodes(this.subjectUniqueID, 0, this.subjectUniqueID.byteLength);\r\n\t\t\r\n\t\tif(\"extensions\" in this)\r\n\t\t\tobject.extensions = Array.from(this.extensions, element => element.toJSON());\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Importing public key for current certificate\r\n\t */\r\n\tgetPublicKey(parameters = null)\r\n\t{\r\n\t\treturn getEngine().subtle.getPublicKey(this.subjectPublicKeyInfo, this.signatureAlgorithm, parameters);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get hash value for subject public key (default SHA-1)\r\n\t * @param {String} [hashAlgorithm=SHA-1] Hashing algorithm name\r\n\t */\r\n\tgetKeyHash(hashAlgorithm = \"SHA-1\")\r\n\t{\r\n\t\t//region Get a \"crypto\" extension\r\n\t\tconst crypto = getCrypto();\r\n\t\tif(typeof crypto === \"undefined\")\r\n\t\t\treturn Promise.reject(\"Unable to create WebCrypto object\");\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn crypto.digest({ name: hashAlgorithm }, new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Make a signature for current value from TBS section\r\n\t * @param {Object} privateKey Private key for \"subjectPublicKeyInfo\" structure\r\n\t * @param {string} [hashAlgorithm=\"SHA-1\"] Hashing algorithm\r\n\t */\r\n\tsign(privateKey, hashAlgorithm = \"SHA-1\")\r\n\t{\r\n\t\t//region Initial checking\r\n\t\t//region Check private key\r\n\t\tif(typeof privateKey === \"undefined\")\r\n\t\t\treturn Promise.reject(\"Need to provide a private key for signing\");\r\n\t\t//endregion\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\tlet parameters;\r\n\t\t\r\n\t\tconst engine = getEngine();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get a \"default parameters\" for current algorithm and set correct signature algorithm\r\n\t\tsequence = sequence.then(() => engine.subtle.getSignatureParameters(privateKey, hashAlgorithm));\r\n\t\t\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\tparameters = result.parameters;\r\n\t\t\tthis.signature = result.signatureAlgorithm;\r\n\t\t\tthis.signatureAlgorithm = result.signatureAlgorithm;\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create TBS data for signing\r\n\t\tsequence = sequence.then(() =>\r\n\t\t{\r\n\t\t\tthis.tbs = this.encodeTBS().toBER(false);\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Signing TBS data on provided private key\r\n\t\tsequence = sequence.then(() => engine.subtle.signWithPrivateKey(this.tbs, privateKey, parameters));\r\n\t\t\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\tthis.signatureValue = new asn1js.BitString({ valueHex: result });\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\tverify(issuerCertificate = null)\r\n\t{\r\n\t\t//region Global variables\r\n\t\tlet subjectPublicKeyInfo = {};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Set correct \"subjectPublicKeyInfo\" value\r\n\t\tif(issuerCertificate !== null)\r\n\t\t\tsubjectPublicKeyInfo = issuerCertificate.subjectPublicKeyInfo;\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(this.issuer.isEqual(this.subject)) // Self-signed certificate\r\n\t\t\t\tsubjectPublicKeyInfo = this.subjectPublicKeyInfo;\r\n\t\t}\r\n\t\t\r\n\t\tif((subjectPublicKeyInfo instanceof PublicKeyInfo) === false)\r\n\t\t\treturn Promise.reject(\"Please provide issuer certificate as a parameter\");\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn getEngine().subtle.verifyWithPublicKey(this.tbs, this.signatureValue, subjectPublicKeyInfo, this.signatureAlgorithm);\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"],"file":"Certificate.js"}