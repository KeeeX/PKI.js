{"version":3,"sources":["../src/SignedCertificateTimestampList.js"],"names":["SignedCertificateTimestamp","parameters","version","defaultValues","logID","timestamp","extensions","hashAlgorithm","signatureAlgorithm","signature","fromSchema","schema","fromStream","stream","asn1js","RawData","Error","seqStream","SeqStream","ByteStream","buffer","data","blockLength","getUint16","getBlock","Uint8Array","slice","Date","extensionsLength","signatureLength","signatureData","asn1","fromBER","offset","result","toStream","appendUint16","byteLength","valueBeforeDecode","appendChar","appendView","timeBuffer","ArrayBuffer","timeView","baseArray","valueOf","set","_hashAlgorithm","toLowerCase","_signatureAlgorithm","_signature","toBER","toJSON","logs","dataType","logId","publicKeyBase64","log","log_id","key","publicKeyInfo","PublicKeyInfo","appendUint24","subtle","verifyWithPublicKey","_stream","_buffer","_length","valueBlock","valueHex","algorithmId","memberName","Any","SignedCertificateTimestampList","timestamps","OctetString","dataLength","length","push","overallLength","timestampsData","timestampStream","view","Array","from","element","memberValue","names","optional","name","blockName","verifySCTsForCertificate","certificate","issuerCertificate","index","parsedValue","crypto","Promise","reject","i","extnID","splice","tbs","encodeTBS","digest","subjectPublicKeyInfo","toSchema","issuerId","preCert","verifyArray","verify","verifyResult"],"mappings":"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","sourcesContent":["import * as asn1js from \"asn1js\";\nimport { getParametersValue, utilFromBase, utilToBase, bufferToHexCodes, toBase64, fromBase64, arrayBufferToString, stringToArrayBuffer } from \"pvutils\";\nimport { ByteStream, SeqStream } from \"bytestreamjs\";\nimport { getCrypto, getEngine } from \"./common.js\";\nimport PublicKeyInfo from \"./PublicKeyInfo.js\";\n//**************************************************************************************\nexport class SignedCertificateTimestamp\n{\n\t//**********************************************************************************\n\t/**\n\t * Constructor for SignedCertificateTimestamp class\n\t * @param {Object} [parameters={}]\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\n\t */\n\tconstructor(parameters = {})\n\t{\n\t\t//region Internal properties of the object\n\t\t/**\n\t\t * @type {number}\n\t\t * @desc version\n\t\t */\n\t\tthis.version = getParametersValue(parameters, \"version\", SignedCertificateTimestamp.defaultValues(\"version\"));\n\t\t/**\n\t\t * @type {ArrayBuffer}\n\t\t * @desc logID\n\t\t */\n\t\tthis.logID = getParametersValue(parameters, \"logID\", SignedCertificateTimestamp.defaultValues(\"logID\"));\n\t\t/**\n\t\t * @type {Date}\n\t\t * @desc timestamp\n\t\t */\n\t\tthis.timestamp = getParametersValue(parameters, \"timestamp\", SignedCertificateTimestamp.defaultValues(\"timestamp\"));\n\t\t/**\n\t\t * @type {ArrayBuffer}\n\t\t * @desc extensions\n\t\t */\n\t\tthis.extensions = getParametersValue(parameters, \"extensions\", SignedCertificateTimestamp.defaultValues(\"extensions\"));\n\t\t/**\n\t\t * @type {string}\n\t\t * @desc hashAlgorithm\n\t\t */\n\t\tthis.hashAlgorithm = getParametersValue(parameters, \"hashAlgorithm\", SignedCertificateTimestamp.defaultValues(\"hashAlgorithm\"));\n\t\t/**\n\t\t * @type {string}\n\t\t * @desc signatureAlgorithm\n\t\t */\n\t\tthis.signatureAlgorithm = getParametersValue(parameters, \"signatureAlgorithm\", SignedCertificateTimestamp.defaultValues(\"signatureAlgorithm\"));\n\t\t/**\n\t\t * @type {Object}\n\t\t * @desc signature\n\t\t */\n\t\tthis.signature = getParametersValue(parameters, \"signature\", SignedCertificateTimestamp.defaultValues(\"signature\"));\n\t\t//endregion\n\t\t\n\t\t//region If input argument array contains \"schema\" for this object\n\t\tif(\"schema\" in parameters)\n\t\t\tthis.fromSchema(parameters.schema);\n\t\t//endregion\n\t\t\n\t\t//region If input argument array contains \"stream\"\n\t\tif(\"stream\" in parameters)\n\t\t\tthis.fromStream(parameters.stream);\n\t\t//endregion\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Return default values for all class members\n\t * @param {string} memberName String name for a class member\n\t */\n\tstatic defaultValues(memberName)\n\t{\n\t\tswitch(memberName)\n\t\t{\n\t\t\tcase \"version\":\n\t\t\t\treturn 0;\n\t\t\tcase \"logID\":\n\t\t\tcase \"extensions\":\n\t\t\t\treturn new ArrayBuffer(0);\n\t\t\tcase \"timestamp\":\n\t\t\t\treturn new Date(0);\n\t\t\tcase \"hashAlgorithm\":\n\t\t\tcase \"signatureAlgorithm\":\n\t\t\t\treturn \"\";\n\t\t\tcase \"signature\":\n\t\t\t\treturn new asn1js.Any();\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestamp class: ${memberName}`);\n\t\t}\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert parsed asn1js object into current class\n\t * @param {!Object} schema\n\t */\n\tfromSchema(schema)\n\t{\n\t\tif((schema instanceof asn1js.RawData) === false)\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestamp\");\n\t\t\n\t\tconst seqStream = new SeqStream({\n\t\t\tstream: new ByteStream({\n\t\t\t\tbuffer: schema.data\n\t\t\t})\n\t\t});\n\t\t\n\t\tthis.fromStream(seqStream);\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert SeqStream data into current class\n\t * @param {!SeqStream} stream\n\t */\n\tfromStream(stream)\n\t{\n\t\tconst blockLength = stream.getUint16();\n\t\t\n\t\tthis.version = (stream.getBlock(1))[0];\n\t\t\n\t\tif(this.version === 0)\n\t\t{\n\t\t\tthis.logID = (new Uint8Array(stream.getBlock(32))).buffer.slice(0);\n\t\t\tthis.timestamp = new Date(utilFromBase(new Uint8Array(stream.getBlock(8)), 8));\n\t\t\t\n\t\t\t//region Extensions\n\t\t\tconst extensionsLength = stream.getUint16();\n\t\t\tthis.extensions = (new Uint8Array(stream.getBlock(extensionsLength))).buffer.slice(0);\n\t\t\t//endregion\n\t\t\t\n\t\t\t//region Hash algorithm\n\t\t\tswitch((stream.getBlock(1))[0])\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tthis.hashAlgorithm = \"none\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.hashAlgorithm = \"md5\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.hashAlgorithm = \"sha1\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.hashAlgorithm = \"sha224\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tthis.hashAlgorithm = \"sha256\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tthis.hashAlgorithm = \"sha384\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\tthis.hashAlgorithm = \"sha512\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\n\t\t\t}\n\t\t\t//endregion\n\t\t\t\n\t\t\t//region Signature algorithm\n\t\t\tswitch((stream.getBlock(1))[0])\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tthis.signatureAlgorithm = \"anonymous\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.signatureAlgorithm = \"rsa\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tthis.signatureAlgorithm = \"dsa\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.signatureAlgorithm = \"ecdsa\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\n\t\t\t}\n\t\t\t//endregion\n\t\t\t\n\t\t\t//region Signature\n\t\t\tconst signatureLength = stream.getUint16();\n\t\t\tconst signatureData = (new Uint8Array(stream.getBlock(signatureLength))).buffer.slice(0);\n\t\t\t\n\t\t\tconst asn1 = asn1js.fromBER(signatureData);\n\t\t\tif(asn1.offset === (-1))\n\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\n\t\t\t\n\t\t\tthis.signature = asn1.result;\n\t\t\t//endregion\n\t\t\t\n\t\t\tif(blockLength !== (47 + extensionsLength + signatureLength))\n\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\n\t\t}\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert current object to asn1js object and set correct values\n\t * @returns {Object} asn1js object\n\t */\n\ttoSchema()\n\t{\n\t\tconst stream = this.toStream();\n\t\t\n\t\treturn new asn1js.RawData({ data: stream.stream.buffer });\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert current object to SeqStream data\n\t * @returns {SeqStream} SeqStream object\n\t */\n\ttoStream()\n\t{\n\t\tconst stream = new SeqStream();\n\t\t\n\t\tstream.appendUint16(47 + this.extensions.byteLength + this.signature.valueBeforeDecode.byteLength);\n\t\tstream.appendChar(this.version);\n\t\tstream.appendView(new Uint8Array(this.logID));\n\t\t\n\t\tconst timeBuffer = new ArrayBuffer(8);\n\t\tconst timeView = new Uint8Array(timeBuffer);\n\t\t\n\t\tconst baseArray = utilToBase(this.timestamp.valueOf(), 8);\n\t\ttimeView.set(new Uint8Array(baseArray), 8 - baseArray.byteLength);\n\t\t\n\t\tstream.appendView(timeView);\n\t\tstream.appendUint16(this.extensions.byteLength);\n\t\t\n\t\tif(this.extensions.byteLength)\n\t\t\tstream.appendView(new Uint8Array(this.extensions));\n\t\t\n\t\tlet _hashAlgorithm;\n\t\t\n\t\tswitch(this.hashAlgorithm.toLowerCase())\n\t\t{\n\t\t\tcase \"none\":\n\t\t\t\t_hashAlgorithm = 0;\n\t\t\t\tbreak;\n\t\t\tcase \"md5\":\n\t\t\t\t_hashAlgorithm = 1;\n\t\t\t\tbreak;\n\t\t\tcase \"sha1\":\n\t\t\t\t_hashAlgorithm = 2;\n\t\t\t\tbreak;\n\t\t\tcase \"sha224\":\n\t\t\t\t_hashAlgorithm = 3;\n\t\t\t\tbreak;\n\t\t\tcase \"sha256\":\n\t\t\t\t_hashAlgorithm = 4;\n\t\t\t\tbreak;\n\t\t\tcase \"sha384\":\n\t\t\t\t_hashAlgorithm = 5;\n\t\t\t\tbreak;\n\t\t\tcase \"sha512\":\n\t\t\t\t_hashAlgorithm = 6;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`);\n\t\t}\n\t\t\n\t\tstream.appendChar(_hashAlgorithm);\n\t\t\n\t\tlet _signatureAlgorithm;\n\t\t\n\t\tswitch(this.signatureAlgorithm.toLowerCase())\n\t\t{\n\t\t\tcase \"anonymous\":\n\t\t\t\t_signatureAlgorithm = 0;\n\t\t\t\tbreak;\n\t\t\tcase \"rsa\":\n\t\t\t\t_signatureAlgorithm = 1;\n\t\t\t\tbreak;\n\t\t\tcase \"dsa\":\n\t\t\t\t_signatureAlgorithm = 2;\n\t\t\t\tbreak;\n\t\t\tcase \"ecdsa\":\n\t\t\t\t_signatureAlgorithm = 3;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`);\n\t\t}\n\t\t\n\t\tstream.appendChar(_signatureAlgorithm);\n\t\t\n\t\tconst _signature = this.signature.toBER(false);\n\t\t\n\t\tstream.appendUint16(_signature.byteLength);\n\t\tstream.appendView(new Uint8Array(_signature));\n\t\t\n\t\treturn stream;\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convertion for the class to JSON object\n\t * @returns {Object}\n\t */\n\ttoJSON()\n\t{\n\t\treturn {\n\t\t\tversion: this.version,\n\t\t\tlogID: bufferToHexCodes(this.logID),\n\t\t\ttimestamp: this.timestamp,\n\t\t\textensions: bufferToHexCodes(this.extensions),\n\t\t\thashAlgorithm: this.hashAlgorithm,\n\t\t\tsignatureAlgorithm: this.signatureAlgorithm,\n\t\t\tsignature: this.signature.toJSON()\n\t\t};\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Verify SignedCertificateTimestamp for specific input data\n\t * @param {Object[]} logs Array of objects with information about each CT Log (like here: https://ct.grahamedgecombe.com/logs.json)\n\t * @param {String} logs.log_id Identifier of the CT Log encoded in BASE-64 format\n\t * @param {String} logs.key Public key of the CT Log encoded in BASE-64 format\n\t * @param {ArrayBuffer} data Data to verify signature against. Could be encoded Certificate or encoded PreCert\n\t * @param {Number} [dataType=0] Type = 0 (data is encoded Certificate), type = 1 (data is encoded PreCert)\n\t * @return {Promise<void>}\n\t */\n\tasync verify(logs, data, dataType = 0)\n\t{\n\t\t//region Initial variables\n\t\tlet logId = toBase64(arrayBufferToString(this.logID));\n\t\t\n\t\tlet publicKeyBase64 = null;\n\t\tlet publicKeyInfo;\n\t\t\n\t\tlet stream = new SeqStream();\n\t\t//endregion\n\t\t\n\t\t//region Found and init public key\n\t\tfor(const log of logs)\n\t\t{\n\t\t\tif(log.log_id === logId)\n\t\t\t{\n\t\t\t\tpublicKeyBase64 = log.key;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(publicKeyBase64 === null)\n\t\t\tthrow new Error(`Public key not found for CT with logId: ${logId}`);\n\t\t\n\t\tconst asn1 = asn1js.fromBER(stringToArrayBuffer(fromBase64(publicKeyBase64)));\n\t\tif(asn1.offset === (-1))\n\t\t\tthrow new Error(`Incorrect key value for CT Log with logId: ${logId}`);\n\t\t\n\t\tpublicKeyInfo = new PublicKeyInfo({ schema: asn1.result });\n\t\t//endregion\n\t\t\n\t\t//region Initialize signed data block\n\t\tstream.appendChar(0x00); // sct_version\n\t\tstream.appendChar(0x00); // signature_type = certificate_timestamp\n\t\t\n\t\tconst timeBuffer = new ArrayBuffer(8);\n\t\tconst timeView = new Uint8Array(timeBuffer);\n\t\t\n\t\tconst baseArray = utilToBase(this.timestamp.valueOf(), 8);\n\t\ttimeView.set(new Uint8Array(baseArray), 8 - baseArray.byteLength);\n\t\t\n\t\tstream.appendView(timeView);\n\t\t\n\t\tstream.appendUint16(dataType);\n\t\t\n\t\tif(dataType === 0)\n\t\t\tstream.appendUint24(data.byteLength);\n\t\t\n\t\tstream.appendView(new Uint8Array(data));\n\t\t\n\t\tstream.appendUint16(this.extensions.byteLength);\n\t\t\n\t\tif(this.extensions.byteLength !== 0)\n\t\t\tstream.appendView(new Uint8Array(this.extensions));\n\t\t//endregion\n\t\t\n\t\t//region Perform verification\n\t\treturn getEngine().subtle.verifyWithPublicKey(\n\t\t\tstream._stream._buffer.slice(0, stream._length),\n\t\t\t{ valueBlock: { valueHex: this.signature.toBER(false) } },\n\t\t\tpublicKeyInfo,\n\t\t\t{ algorithmId: \"\" },\n\t\t\t\"SHA-256\"\n\t\t);\n\t\t//endregion\n\t}\n\t//**********************************************************************************\n}\n//**************************************************************************************\n/**\n * Class from RFC6962\n */\nexport default class SignedCertificateTimestampList\n{\n\t//**********************************************************************************\n\t/**\n\t * Constructor for SignedCertificateTimestampList class\n\t * @param {Object} [parameters={}]\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\n\t */\n\tconstructor(parameters = {})\n\t{\n\t\t//region Internal properties of the object\n\t\t/**\n\t\t * @type {Array.<SignedCertificateTimestamp>}\n\t\t * @desc timestamps\n\t\t */\n\t\tthis.timestamps = getParametersValue(parameters, \"timestamps\", SignedCertificateTimestampList.defaultValues(\"timestamps\"));\n\t\t//endregion\n\t\t\n\t\t//region If input argument array contains \"schema\" for this object\n\t\tif(\"schema\" in parameters)\n\t\t\tthis.fromSchema(parameters.schema);\n\t\t//endregion\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Return default values for all class members\n\t * @param {string} memberName String name for a class member\n\t */\n\tstatic defaultValues(memberName)\n\t{\n\t\tswitch(memberName)\n\t\t{\n\t\t\tcase \"timestamps\":\n\t\t\t\treturn [];\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestampList class: ${memberName}`);\n\t\t}\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Compare values with default values for all class members\n\t * @param {string} memberName String name for a class member\n\t * @param {*} memberValue Value to compare with default value\n\t */\n\tstatic compareWithDefault(memberName, memberValue)\n\t{\n\t\tswitch(memberName)\n\t\t{\n\t\t\tcase \"timestamps\":\n\t\t\t\treturn (memberValue.length === 0);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestampList class: ${memberName}`);\n\t\t}\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Return value of pre-defined ASN.1 schema for current class\n\t *\n\t * ASN.1 schema:\n\t * ```asn1\n\t * SignedCertificateTimestampList ::= OCTET STRING\n\t * ```\n\t *\n\t * @param {Object} parameters Input parameters for the schema\n\t * @returns {Object} asn1js schema object\n\t */\n\tstatic schema(parameters = {})\n\t{\n\t\t/**\n\t\t * @type {Object}\n\t\t * @property {string} [blockName]\n\t\t * @property {string} [optional]\n\t\t */\n\t\tconst names = getParametersValue(parameters, \"names\", {});\n\t\t\n\t\tif((\"optional\" in names) === false)\n\t\t\tnames.optional = false;\n\t\t\n\t\treturn (new asn1js.OctetString({\n\t\t\tname: (names.blockName || \"SignedCertificateTimestampList\"),\n\t\t\toptional: names.optional\n\t\t}));\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert parsed asn1js object into current class\n\t * @param {!Object} schema\n\t */\n\tfromSchema(schema)\n\t{\n\t\t//region Check the schema is valid\n\t\tif((schema instanceof asn1js.OctetString) === false)\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestampList\");\n\t\t//endregion\n\t\t\n\t\t//region Get internal properties from parsed schema\n\t\tconst seqStream = new SeqStream({\n\t\t\tstream: new ByteStream({\n\t\t\t\tbuffer: schema.valueBlock.valueHex\n\t\t\t})\n\t\t});\n\t\t\n\t\tlet dataLength = seqStream.getUint16();\n\t\tif(dataLength !== seqStream.length)\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestampList\");\n\t\t\n\t\twhile(seqStream.length)\n\t\t\tthis.timestamps.push(new SignedCertificateTimestamp({ stream: seqStream }));\n\t\t//endregion\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convert current object to asn1js object and set correct values\n\t * @returns {Object} asn1js object\n\t */\n\ttoSchema()\n\t{\n\t\t//region Initial variables\n\t\tconst stream = new SeqStream();\n\t\t\n\t\tlet overallLength = 0;\n\t\t\n\t\tconst timestampsData = [];\n\t\t//endregion\n\t\t\n\t\t//region Get overall length\n\t\tfor(const timestamp of this.timestamps)\n\t\t{\n\t\t\tconst timestampStream = timestamp.toStream();\n\t\t\ttimestampsData.push(timestampStream);\n\t\t\toverallLength += timestampStream.stream.buffer.byteLength;\n\t\t}\n\t\t//endregion\n\t\t\n\t\tstream.appendUint16(overallLength);\n\t\t\n\t\t//region Set data from all timestamps\n\t\tfor(const timestamp of timestampsData)\n\t\t\tstream.appendView(timestamp.stream.view);\n\t\t//endregion\n\t\t\n\t\treturn new asn1js.OctetString({ valueHex: stream.stream.buffer.slice(0) });\n\t}\n\t//**********************************************************************************\n\t/**\n\t * Convertion for the class to JSON object\n\t * @returns {Object}\n\t */\n\ttoJSON()\n\t{\n\t\treturn {\n\t\t\ttimestamps: Array.from(this.timestamps, element => element.toJSON())\n\t\t};\n\t}\n\t//**********************************************************************************\n}\n//**************************************************************************************\n/**\n * Verify SignedCertificateTimestamp for specific certificate content\n * @param {Certificate} certificate Certificate for which verification would be performed\n * @param {Certificate} issuerCertificate Certificate of the issuer of target certificate\n * @param {Object[]} logs Array of objects with information about each CT Log (like here: https://ct.grahamedgecombe.com/logs.json)\n * @param {String} logs.log_id Identifier of the CT Log encoded in BASE-64 format\n * @param {String} logs.key Public key of the CT Log encoded in BASE-64 format\n * @param {Number} [index=-1] Index of SignedCertificateTimestamp inside SignedCertificateTimestampList (for -1 would verify all)\n * @return {Array} Array of verification results\n */\nexport async function verifySCTsForCertificate(certificate, issuerCertificate, logs, index = (-1))\n{\n\t//region Initial variables\n\tlet parsedValue = null;\n\tlet tbs;\n\tlet issuerId;\n\t\n\tconst stream = new SeqStream();\n\t\n\tlet preCert;\n\t//endregion\n\t\n\t//region Get a \"crypto\" extension\n\tconst crypto = getCrypto();\n\tif(typeof crypto === \"undefined\")\n\t\treturn Promise.reject(\"Unable to create WebCrypto object\");\n\t//endregion\n\t\n\t//region Remove certificate extension\n\tfor(let i = 0; i < certificate.extensions.length; i++)\n\t{\n\t\tswitch(certificate.extensions[i].extnID)\n\t\t{\n\t\t\tcase \"1.3.6.1.4.1.11129.2.4.2\":\n\t\t\t\t{\n\t\t\t\t\tparsedValue = certificate.extensions[i].parsedValue;\n\t\t\t\t\t\n\t\t\t\t\tif(parsedValue.timestamps.length === 0)\n\t\t\t\t\t\tthrow new Error(\"Nothing to verify in the certificate\");\n\t\t\t\t\t\n\t\t\t\t\tcertificate.extensions.splice(i, 1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\t//endregion\n\t\n\t//region Check we do have what to verify\n\tif(parsedValue === null)\n\t\tthrow new Error(\"No SignedCertificateTimestampList extension in the specified certificate\");\n\t//endregion\n\t\n\t//region Prepare modifier TBS value\n\ttbs = certificate.encodeTBS().toBER(false);\n\t//endregion\n\t\n\t//region Initialize \"issuer_key_hash\" value\n\tissuerId = await crypto.digest({ name: \"SHA-256\" }, new Uint8Array(issuerCertificate.subjectPublicKeyInfo.toSchema().toBER(false)));\n\t//endregion\n\t\n\t//region Make final \"PreCert\" value\n\tstream.appendView(new Uint8Array(issuerId));\n\tstream.appendUint24(tbs.byteLength);\n\tstream.appendView(new Uint8Array(tbs));\n\t\n\tpreCert = stream._stream._buffer.slice(0, stream._length);\n\t//endregion\n\t\n\t//region Call verification function for specified index\n\tif(index === (-1))\n\t{\n\t\tconst verifyArray = [];\n\t\t\n\t\tfor(const timestamp of parsedValue.timestamps)\n\t\t{\n\t\t\tconst verifyResult = await timestamp.verify(logs, preCert, 1);\n\t\t\tverifyArray.push(verifyResult);\n\t\t}\n\t\t\n\t\treturn verifyArray;\n\t}\n\t\n\tif(index >= parsedValue.timestamps.length)\n\t\tindex = (parsedValue.timestamps.length - 1);\n\t\n\treturn [await parsedValue.timestamps[index].verify(logs, preCert, 1)];\n\t//endregion\n}\n//**********************************************************************************\n"],"file":"SignedCertificateTimestampList.js"}